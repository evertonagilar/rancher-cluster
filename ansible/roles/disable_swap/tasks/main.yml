---
- name: Disable swap immediately
  ansible.builtin.command:
    cmd: swapoff -a
  changed_when: true

- name: Remove swap entries from /etc/fstab
  ansible.builtin.lineinfile:
    path: /etc/fstab
    regexp: '^[^#].*\s+swap\s+'
    state: absent
  notify: Verify swap is disabled

- name: Verify swap is disabled
  ansible.builtin.command:
    cmd: swapon --show
  register: swap_status
  changed_when: false
  failed_when: swap_status.stdout != ""
